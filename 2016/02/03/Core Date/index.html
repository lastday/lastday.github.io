
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>iOS9 Core Data教学 | Lastdays</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Lastdays">
    

    
    <meta name="description" content="看了一篇国外的文章，关于iOS9的Core Data教学，在这里做了一下总结Core Data 教学示例开源地址：LastDayCoreData
在这篇文章中我们将学习Core Data的系列教程，你将使用Swift2.0写你的Core Data。你将发现在Xcode中它是很容易上手的，从启动代码导师数据模型编辑器。在教程结束后，你会了解到：

使用Xcode的model editor将你想存储在">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS9 Core Data教学">
<meta property="og:url" content="http://yoursite.com/2016/02/03/Core Date/index.html">
<meta property="og:site_name" content="Lastdays">
<meta property="og:description" content="看了一篇国外的文章，关于iOS9的Core Data教学，在这里做了一下总结Core Data 教学示例开源地址：LastDayCoreData
在这篇文章中我们将学习Core Data的系列教程，你将使用Swift2.0写你的Core Data。你将发现在Xcode中它是很容易上手的，从启动代码导师数据模型编辑器。在教程结束后，你会了解到：

使用Xcode的model editor将你想存储在">
<meta property="og:image" content="http://cdn4.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-2.png">
<meta property="og:image" content="http://cdn4.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-4.png">
<meta property="og:image" content="http://cdn4.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-7.png">
<meta property="og:image" content="http://cdn1.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-10.png">
<meta property="og:image" content="http://cdn4.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-12.png">
<meta property="og:image" content="http://cdn3.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-14.png">
<meta property="og:image" content="http://cdn4.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-15.png">
<meta property="og:image" content="http://cdn2.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-17.png">
<meta property="og:image" content="http://cdn2.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-19.png">
<meta property="og:image" content="http://cdn3.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-20.png">
<meta property="og:image" content="http://cdn5.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-21.png">
<meta property="og:image" content="http://cdn4.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-22.png">
<meta property="og:image" content="http://cdn2.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-24.png">
<meta property="og:image" content="http://cdn4.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-26.png">
<meta property="og:image" content="http://cdn5.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-28.png">
<meta property="og:updated_time" content="2016-02-03T13:23:53.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS9 Core Data教学">
<meta name="twitter:description" content="看了一篇国外的文章，关于iOS9的Core Data教学，在这里做了一下总结Core Data 教学示例开源地址：LastDayCoreData
在这篇文章中我们将学习Core Data的系列教程，你将使用Swift2.0写你的Core Data。你将发现在Xcode中它是很容易上手的，从启动代码导师数据模型编辑器。在教程结束后，你会了解到：

使用Xcode的model editor将你想存储在">

    
    <link rel="alternative" href="/atom.xml" title="Lastdays" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Lastdays" title="Lastdays"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Lastdays">Lastdays</a></h1>
				<h2 class="blog-motto">欢迎来到一个喜欢白菜的90后的世界</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
						<form class="search" action="http://zhannei.baidu.com/cse/search" target="_blank">
							<label>Search</label>
						<input name="s" type="hidden" value= null ><input type="text" name="q" size="30" placeholder="搜索"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/02/03/Core Date/" title="iOS9 Core Data教学" itemprop="url">iOS9 Core Data教学</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Lastdays" target="_blank" itemprop="author">Lastdays</a>
		
  <p class="article-time">
    <time datetime="2016-02-03T13:23:53.000Z" itemprop="datePublished"> 发表于 2016-02-03</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#u770B_u4E86_u4E00_u7BC7_u56FD_u5916_u7684_u6587_u7AE0_uFF0C_u5173_u4E8EiOS9_u7684Core_Data_u6559_u5B66_uFF0C_u5728_u8FD9_u91CC_u505A_u4E86_u4E00_u4E0B_u603B_u7ED3"><span class="toc-number">1.</span> <span class="toc-text">看了一篇国外的文章，关于iOS9的Core Data教学，在这里做了一下总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Core_Data__u6559_u5B66"><span class="toc-number">2.</span> <span class="toc-text">Core Data 教学</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#u5F00_u59CB"><span class="toc-number">2.1.</span> <span class="toc-text">开始</span></a></li></ol></li></ol>
		
		</div>
		
		<h1 id="u770B_u4E86_u4E00_u7BC7_u56FD_u5916_u7684_u6587_u7AE0_uFF0C_u5173_u4E8EiOS9_u7684Core_Data_u6559_u5B66_uFF0C_u5728_u8FD9_u91CC_u505A_u4E86_u4E00_u4E0B_u603B_u7ED3"><a href="#u770B_u4E86_u4E00_u7BC7_u56FD_u5916_u7684_u6587_u7AE0_uFF0C_u5173_u4E8EiOS9_u7684Core_Data_u6559_u5B66_uFF0C_u5728_u8FD9_u91CC_u505A_u4E86_u4E00_u4E0B_u603B_u7ED3" class="headerlink" title="看了一篇国外的文章，关于iOS9的Core Data教学，在这里做了一下总结"></a>看了一篇国外的文章，关于iOS9的Core Data教学，在这里做了一下总结</h1><h1 id="Core_Data__u6559_u5B66"><a href="#Core_Data__u6559_u5B66" class="headerlink" title="Core Data 教学"></a>Core Data 教学</h1><p>示例开源地址：<a href="https://github.com/MrLoong/LastDayCoreData" target="_blank" rel="external">LastDayCoreData</a></p>
<p>在这篇文章中我们将学习Core Data的系列教程，你将使用Swift2.0写你的Core Data。你将发现在Xcode中它是很容易上手的，从启动代码导师数据模型编辑器。在教程结束后，你会了解到：</p>
<ul>
<li>使用Xcode的model editor将你想存储在Core Data。</li>
<li>添加新的记录到 Core Data</li>
<li>从Core Data中读取一组数据</li>
<li>在表视图中显示所获取的结果</li>
</ul>
<p>你也将会了解Core Data背后的数据是什么，以及如何进行交互。OK，现在让我们来构建我的app吧。</p>
<h2 id="u5F00_u59CB"><a href="#u5F00_u59CB" class="headerlink" title="开始"></a>开始</h2><p>打开你的Xcode新建一个iPhone工程，选择Single View Application template起名为HitList并且选择Use Core Data。</p>
<p><img src="http://cdn4.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-2.png" alt=""></p>
<p>选中Use Core Data复选框后将会在AppDelegate.swift生成Core Data stack样本代码</p>
<p>Core Data stack由一组对象组成，方便于检索和保存Core Data的数据。有一个对象最为一个整体来管理Care Data的状态和数据模型等等。</p>
<p>这个示例程序的想法很简单。有一个被叫”hit list”的表视图。你可以在这个列表中添加名字，并且最终你将使用Core Data确保数据在各个环节之间。</p>
<p>点击Main.storyboard在Interface Builder.接下来点击Editor，选择Navigation Controller。具体操作如图所示:<br><img src="http://cdn4.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-4.png" alt=""></p>
<p>返回Interface Builder，拖拽一个Table view。</p>
<p>接下来拖拽一个Bar Button Item将它放置到navigation bar。最终，起名为Add。就像这样</p>
<p><img src="http://cdn4.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-7.png" alt=""></p>
<p>当你每次点击Add的时候，一个包含文本信息字段的弹框将会出现在屏幕上显示。在那里你能够输入默认的名字到进入文本域。</p>
<p>如果你想知道原因，你可以不设置表示图的委托，这样就不会触发任何行为。</p>
<p>打开Assistant Editor拖拽table view到 ViewController.swift，在类中插入一个outlet：</p>
<p><img src="http://cdn1.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-10.png" alt=""></p>
<p>起名为 tableview</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@IBOutlet weak var tableView: UITableView!</span><br></pre></td></tr></table></figure>
<p>同样将Add拖拽到ViewController.swift，创建一个action 命名为addName：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@IBAction func addName(sender: AnyObject) &#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么现在你可引用表示图和按钮了。接下来就是建立表示图模型。在ViewContrroller.swift中添加一下代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//Insert below the tableView IBOutlet</span><br><span class="line">var names = [String]()</span><br></pre></td></tr></table></figure>
<p>names是一个可变的shtring类型的数组，在tableview中显示。</p>
<p>在viewDidLoad()中实现一下代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">override func <span class="function"><span class="title">viewDidLoad</span></span>() &#123;</span><br><span class="line">  super.viewDidLoad()</span><br><span class="line">  title = <span class="string">"\"The List\""</span></span><br><span class="line">  tableView.registerClass(UITableViewCell.self,</span><br><span class="line">    <span class="keyword">for</span>CellReuseIdentifier: <span class="string">"Cell"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里将建立一个标题，注册UITableViewCell在table view类中。table view将返回正确类型的cell</p>
<p>仍然在ViewController.swift，添加UITableViewDataSource,UITableViewDelegate</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//Add UITableViewDataSource to class declaration</span><br><span class="line">class ViewController: UIViewController, UITableViewDataSource, UITableViewDelegate&#123;</span><br><span class="line">  //这里添加</span><br><span class="line">	tableView.dataSource = self</span><br><span class="line">	tableView.delegate = self</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个时候Xcode会提示ViewCotroller不符合协议.实现data source方法修改这个错误。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// MARK: UITableViewDataSource</span><br><span class="line">func tableView(tableView: UITableView,</span><br><span class="line">  numberOfRowsInSection section: Int) -&gt; Int &#123;</span><br><span class="line">  <span class="built_in">return</span> names.count</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">func tableView(tableView: UITableView,</span><br><span class="line">  cellForRowAtIndexPath</span><br><span class="line">  indexPath: NSIndexPath) -&gt; UITableViewCell &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">let</span> cell =</span><br><span class="line">  tableView.dequeueReusableCellWithIdentifier(<span class="string">"Cell"</span>)</span><br><span class="line"> </span><br><span class="line">  cell!.textLabel!.text = names[indexPath.row]</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">return</span> cell!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果你用过UITableView，这段代码看起来会很相似。第一个方法就是names数量。</p>
<p>第二个方法tableView(_:cellForRowAtIndexPath:)返回对cell对象。</p>
<p>不要现在就运行。首先你需要一个输入names的方法然后在table view中进行显示他们。</p>
<p>实现addName IBAction</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">//Implement the addName IBAction</span><br><span class="line">@IBAction func addName(sender: AnyObject) &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">let</span> alert = UIAlertController(title: <span class="string">"New Name"</span>,</span><br><span class="line">    message: <span class="string">"Add a new name"</span>,</span><br><span class="line">    preferredStyle: .Alert)</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">let</span> saveAction = UIAlertAction(title: <span class="string">"Save"</span>,</span><br><span class="line">    style: .Default,</span><br><span class="line">    handler: &#123; (action:UIAlertAction) -&gt; Void <span class="keyword">in</span></span><br><span class="line"> </span><br><span class="line">      <span class="built_in">let</span> textField = alert.textFields!.first</span><br><span class="line">      self.names.append(textField!.text!)</span><br><span class="line">      self.viewWillAppear(<span class="literal">true</span>)</span><br><span class="line">      self.tableView.reloadData()</span><br><span class="line">  &#125;)</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">let</span> cancelAction = UIAlertAction(title: <span class="string">"Cancel"</span>,</span><br><span class="line">    style: .Default) &#123; (action: UIAlertAction) -&gt; Void <span class="keyword">in</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  alert.addTextFieldWithConfigurationHandler &#123;</span><br><span class="line">    (textField: UITextField) -&gt; Void <span class="keyword">in</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  alert.addAction(saveAction)</span><br><span class="line">  alert.addAction(cancelAction)</span><br><span class="line"> </span><br><span class="line">  presentViewController(alert,</span><br><span class="line">    animated: <span class="literal">true</span>,</span><br><span class="line">    completion: nil)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每次点击Add按钮的时候，这个方法该方法弹出文本域和两个按钮，保存和取消。</p>
<p>点击保存，将其名称插入到数组中，table view将重新加载数据并显示。</p>
<p>在这里，构建并且第一次运行我们的应用程序。点击顶部的Add按钮，将会插入一个弹框。</p>
<p><img src="http://cdn4.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-12.png" alt=""></p>
<p>添加4个或者5个左右的数据，就是下面的样子</p>
<p><img src="http://cdn3.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-14.png" alt=""></p>
<p>你的table view将显示数据，但是并不能实现持久化，什么意思呢？就是说我们现在的数组数据是存放在内存中的，但是如果我们一旦强制退出应用程序或者重新启动你的设备，你的数组数据就会被销毁。</p>
<p>Core Data提供持久化，意思就是他可让数据保持为持久状态，尽管应用重新启动或者是重新运行。</p>
<p>你现在还没有添加任何Core Data。让我们来测试下，切换到Simulator，点击Shift+⌘+H,将会返回home界面。</p>
<p><img src="http://cdn4.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-15.png" alt=""></p>
<p>看到HitList图标，点击它切换到应用，这些名字一样存在着。这跟我们刚才描述的不一样，为什么呢？</p>
<p>当你点击Home按钮的时候。这个时候操作系统会瞬间冻结所有当前在内存中的一切信息。包括我们的名称数组字符串。同样，当我们的应用切换回去的时候，操作系统会恢复过去的记忆，就像你从来没有离开过一样，意思就是我们的names被恢复了。</p>
<p>多任务模式早在iOS 4中推出。他们创造了iOS用户无缝体验，同时也添加了持续性的概念，这心真的存在吗？</p>
<p>不，这不是真的。如果你完全杀死应用程序或者关闭你的iPhone，你的names数组就会消失。你可以体验下，快速的双击Home。</p>
<p><img src="http://cdn2.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-17.png" alt=""></p>
<p>在这里，向上拉动你的应程序，在这里就会将程序杀死了。这个时候反回Home，再一次点击你的应用程序，names就会消失。</p>
<p>以上展现的两种方式书有差异的，所以这里看来了解熟悉多任务模式是显而易见的。但是这个在用户的头脑中是没有什么区别的。用户不会在乎通过哪种方式切回到Home，或者切回到应用。</p>
<p>现在的问题就是怎么样让应用无论通过哪种方式返回都能够存在。</p>
<p>现在就到了我们要讲诉的东西了，实现真正的持久性，数据在一个应用中无论怎样都会存在着。</p>
<p>##数据建模</p>
<p>现在你知道如何检测持久性了，让我们开始Core Data的学习。你的目标很简单，就是持久化你输入的名字，重新启动后仍然存在这个应用程序中。</p>
<p>这这里，你已经了解了如何在内存中存储names名称。在这里你将使用Core Data代替那种方法。</p>
<p>第一步就是创建一个managed object model，就是意味着通过Core Data数据将在磁盘上。默认情况下，Core Data使用SQlite数据库作为持久化的存储，所以你可以想象数据模型看成数据库架构。</p>
<p>当你创建了工程的时候我们选择了Use Core Data，Xcode会自动创建一个数据模型文件叫做HitList.xcdatamodeld</p>
<p><img src="http://cdn2.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-19.png" alt=""></p>
<p>点击HitList.xcdatamodeld打开它，正如你所看到的，Xcode有自己的数据模型编辑器，就像如图所示那样</p>
<p><img src="http://cdn3.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-20.png" alt=""></p>
<p>这个数据模型有很多功能，让我们创建一个简单的数据实体。</p>
<p>在左下方点击 Add Entity创建一个新的实体，双击我们新创建的实体，并且改名为Person，就像这样：</p>
<p><img src="http://cdn5.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-21.png" alt=""></p>
<p>你可能很想知道为什么数据模型编辑器使用”实体”，而不是简单的定义一个新类。你不久就会看到，Core Data的数据来源于自身的词汇表。以下有一些常见的书语你可能会遇到：</p>
<ul>
<li>在Core Data中一个entity是一个类的定义。举一个典型的例子就是员工和公司的例子。在关系型数据库中，一个实体对应一个表。</li>
<li>一个attribute是连接到特定实体信息的一部分。例如，一个员工可以拥有姓名，职位，工资等attribute。在数据库中attribute（属性）对应表中特定的字段。</li>
<li>relationship是多个实体之间的一个连接。</li>
</ul>
<p>现在你知道了什么是attribute，返回模型编辑并且添加一个attribute到Person中，选择Person，点击+。</p>
<p>建立一个name并且选择类型为String。</p>
<p><img src="http://cdn4.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-22.png" alt=""></p>
<p>在Core Data包含很多种数据类型，String是其中的一种。</p>
<p>##保存数据到Core Data</p>
<p>在ViewCortroller.swift中 Import Core Data</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//Add below <span class="string">"import UIKit"</span></span><br><span class="line">import CoreData</span><br></pre></td></tr></table></figure>
<p>在Objective-C你可能不得不手动链接框架，但是在Swift中，一个简单的Import语句就就可以让你在你的代码中使用API。</p>
<p>接下来，更换模型。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//将names变味people，并且将people类型改为NSManagedObject类型</span><br><span class="line">var people = [NSManagedObject]()</span><br></pre></td></tr></table></figure>
<p>接下来你存储的是Person实体而不是names，所以将数据模型更名为people，并且它现在是NSManagedObject类型而不是简单的String类型。</p>
<p>NSManagedObject被称为在Core Data中的单一对象。你必须使用它创建，修改，保存和删除操作你的持久数据。</p>
<p>就在刚刚你已经改变了视图的模型，你必须也要使用下面的代码替换原来的数据源。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//Replace both UITableViewDataSource methods</span><br><span class="line">func tableView(tableView: UITableView,</span><br><span class="line">  numberOfRowsInSection section: Int) -&gt; Int &#123;</span><br><span class="line">    <span class="built_in">return</span> people.count</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">func tableView(tableView: UITableView,</span><br><span class="line">  cellForRowAtIndexPath</span><br><span class="line">  indexPath: NSIndexPath) -&gt; UITableViewCell &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">let</span> cell =</span><br><span class="line">    tableView.dequeueReusableCellWithIdentifier(<span class="string">"Cell"</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">let</span> person = people[indexPath.row]</span><br><span class="line"> </span><br><span class="line">    cell!.textLabel!.text =</span><br><span class="line">      person.valueForKey(<span class="string">"name"</span>) as? String</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">return</span> cell!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其实通过比较来看其实最显著的变化在cellForRowAtIndexPath，仔细看看就能够发现其中的变化。</p>
<p>当然，你需要注意的地方还有就是你是如何从NSManagedObject抓去name属性。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cell!.textLabel!.text = person.valueForKey(<span class="string">"name"</span>) as? String</span><br></pre></td></tr></table></figure>
<p>为什么用以上的方式呢？因为NSManagedObject并不知道在你的数据模型中name是如何被定义在你的数据模型中的，因此没有办法直接访问你的name属性。唯一的方法就是用过Core Data提供的key-value来读取，这种方式通常被叫做KVC。</p>
<p>我在这里同样也简单的介绍一下KVC吧。就是说如果你是一个新的iOS开发者可能不了解什么是KVC或者是key-vale编码。KVC就是Cocoa和Cocoa Touch的机制来访问一个对象的而属性间接的使用字符串来识别。在以上的情况下，KVC就像是一本字典。</p>
<p>接下来就是改变我们@IBAction addName方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> saveAction = UIAlertAction(title: <span class="string">"Save"</span>,</span><br><span class="line">  style: .Default,</span><br><span class="line">  handler: &#123; (action:UIAlertAction) -&gt; Void <span class="keyword">in</span></span><br><span class="line"> </span><br><span class="line">    <span class="built_in">let</span> textField = alert.textFields!.first</span><br><span class="line">    self.saveName(textField!.text!)</span><br><span class="line">    self.tableView.reloadData()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>看到上面我们有新添加了一个saveName方法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">func saveName(name: String) &#123;</span><br><span class="line">  //<span class="number">1</span></span><br><span class="line">  <span class="built_in">let</span> appDelegate =</span><br><span class="line">  UIApplication.sharedApplication().delegate as! AppDelegate</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">let</span> managedContext = appDelegate.managedObjectContext</span><br><span class="line"> </span><br><span class="line">  //<span class="number">2</span></span><br><span class="line">  <span class="built_in">let</span> entity =  NSEntityDescription.entityForName(<span class="string">"Person"</span>,</span><br><span class="line">    <span class="keyword">in</span>ManagedObjectContext:managedContext)</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">let</span> person = NSManagedObject(entity: entity!,</span><br><span class="line">    insertIntoManagedObjectContext: managedContext)</span><br><span class="line"> </span><br><span class="line">  //<span class="number">3</span></span><br><span class="line">  person.setValue(name, <span class="keyword">for</span>Key: <span class="string">"name"</span>)</span><br><span class="line"> </span><br><span class="line">  //<span class="number">4</span></span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    try managedContext.save()</span><br><span class="line">  //<span class="number">5</span></span><br><span class="line">    people.append(person)</span><br><span class="line">  &#125; catch <span class="built_in">let</span> error as NSError  &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">"Could not save \(error), \(error.userInfo)"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里面都是什么呢？我们来分析下</p>
<ul>
<li>在你做svae操作之前，你需要先获取NSManagedObjectContext。你可以认为这是用来managed object context的。想进行保存对象到Core Data中需要两步，首先，你需要插入一个对象到managed object context中。然后提交，将该对象存储到磁盘中。Xcode其实已经产生一个通用的模板，当你选择Use Core Data的时候。这个默认的managed object context存在于application delegate中。要想引用它，你需要获取一个app delegate引用。</li>
<li>创建managed object context并且完成NSManagedObject的初始化，init(entity:insertIntoManagedObjectContext:).你可能会想到NSEntityDescription的所有相关东西</li>
<li>使用NSManagedObject，必须使用你建立的name，必须使用KVC，否则会出现崩溃现象。</li>
<li>你的提交的person被保存在磁盘中，注意save会抛出异常，这就是为什么我们需要使用try do。</li>
<li>接下来就要恭喜你已经成功并且安全的的实现了数据的持久化。仍然是当我们插入后将会重新加载视图</li>
</ul>
<p>这比使用一个字符串可能复杂的很多，但是并不是很复杂。这里的代码就是获取managed object context和entity，</p>
<p>构建并且运行，添加一些类似下面的名字。</p>
<p><img src="http://cdn2.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-24.png" alt=""></p>
<p>如果你的数据已经在Core Data中存储，并且实现了数据的持久化，这个时候我们杀死我们的app，然后重现加载我们程序，等一下，发生了什么？table view是空的</p>
<p><img src="http://cdn4.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-26.png" alt=""></p>
<p>你存续到Core Data中的数据但是重新加载后并没有，仍然是空的，其实数据事实上在那里的等待着，你并没有显示它、</p>
<p>从Core Data中获取</p>
<p>要得到持久化的数据，你必须取出它。在ViewController.swift中天添加一个方法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">override func viewWillAppear(animated: Bool) &#123;</span><br><span class="line">  super.viewWillAppear(animated)</span><br><span class="line"> </span><br><span class="line">  //<span class="number">1</span></span><br><span class="line">  <span class="built_in">let</span> appDelegate =</span><br><span class="line">  UIApplication.sharedApplication().delegate as! AppDelegate</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">let</span> managedContext = appDelegate.managedObjectContext</span><br><span class="line"> </span><br><span class="line">  //<span class="number">2</span></span><br><span class="line">  <span class="built_in">let</span> fetchRequest = NSFetchRequest(entityName: <span class="string">"Person"</span>)</span><br><span class="line"> </span><br><span class="line">  //<span class="number">3</span></span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="built_in">let</span> results =</span><br><span class="line">      try managedContext.executeFetchRequest(fetchRequest)</span><br><span class="line">    people = results as! [NSManagedObject]</span><br><span class="line">  &#125; catch <span class="built_in">let</span> error as NSError &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Could not fetch \(error), \(error.userInfo)"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上代码中做了什么？</p>
<ul>
<li>就像刚才说的，在做一些操作前你需要获取一个managed object context。从delegate中引用managed object context.</li>
<li>根据名字就能看出来，NSFetchRequest就是返回的数据。</li>
<li>executefetchrequest()返回满足managed objects读取请求中指定的标准数组。</li>
</ul>
<p>构建并且重新运行，就能发现你想要的效果了</p>
<p><img src="http://cdn5.raywenderlich.com/wp-content/uploads/2015/09/CoreData2-28.png" alt=""></p>
<p>现在你就可以随意的测试了。</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2016/02/03/Core Date/" data-title="iOS9 Core Data教学 | Lastdays" data-tsina="5848341536" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/02/03/IP/" title="IP协议总结">
  <strong>上一篇：</strong><br/>
  <span>
  IP协议总结</span>
</a>
</div>


</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2016/02/03/Core Date/" data-title="iOS9 Core Data教学" data-url="http://yoursite.com/2016/02/03/Core Date/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#u770B_u4E86_u4E00_u7BC7_u56FD_u5916_u7684_u6587_u7AE0_uFF0C_u5173_u4E8EiOS9_u7684Core_Data_u6559_u5B66_uFF0C_u5728_u8FD9_u91CC_u505A_u4E86_u4E00_u4E0B_u603B_u7ED3"><span class="toc-number">1.</span> <span class="toc-text">看了一篇国外的文章，关于iOS9的Core Data教学，在这里做了一下总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Core_Data__u6559_u5B66"><span class="toc-number">2.</span> <span class="toc-text">Core Data 教学</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#u5F00_u59CB"><span class="toc-number">2.1.</span> <span class="toc-text">开始</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="MrLoong" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  

  

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=5848341536&verifier=b03f6446&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 我叫Lastdays，一个喜欢白菜的90后，单线程的iOS开发男孩. <br/>
			这是我的博客，我在这里分享我的一切.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/5848341536" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/MrLoong" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="Lastdays">Lastdays</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"Days Last"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?359a67e4b1b43ca291f946419c2423c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
